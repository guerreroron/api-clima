<!DOCTYPE html>
<html lang="es-CL">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Api-Clima Full Stack Python">
    <meta name="author" content="Ronald Guerrero 0071">
    <meta name="keywords" content="Api-clima Ajax Jquery Javascript Openweathermap">
    <title>API-CLIMA</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script>
        $(document).ready(function(){

                $('#btn_buscar').click(function(){
                    let getValue = $('#txt_city').val(); 
                    let str = getValue.toUpperCase();
                    const apikey = $('#apikey').val();
                    let url = `https://api.openweathermap.org/data/2.5/weather?q=${str}&appid=${apikey}&units=metric&lang=es`;               
                    
                    $('#city_h2').html(str);

                    console.log(str);
                    console.log(apikey);
                    console.log(url);
                    
                    $.get(url, function(data){
                        
                        let country = data.sys.country;
                        let lon = data.coord.lon;
                        let lat = data.coord.lat;
                        let desc = data.weather[0].description
                        let temp = data.main.temp;
                        let tmin = data.main.temp_min;
                        let tmax = data.main.temp_max;
                        let press = data.main.pressure;
                        let hum = data.main.humidity;
                        let wind = data.wind.speed;
                        let dir = data.wind.deg;
                        let city = data.name;

                        $('#country').html(country);
                        $("#lon").html(lon);
                        $("#lat").html(lat);
                        $("#desc").html(desc);
                        $("#temp").html(temp);
                        $("#temp_min").html(tmin);
                        $("#temp_max").html(tmax);
                        $("#pressure").html(press);
                        $("#humidity").html(hum);
                        $("#speed").html(wind);
                        $("#deg").html(dir);
                        
                    
                    },'json');       

            });
        });
    </script>
    
</head>
<body>
    <div class="wrapper">
        <div class="container-fluid p-5 bg-light">
            <div class="container my-4">
                <div class="row mb-4">
                    <h4 class="fs-4">Aplicación del tiempo por ciudad</h4>
                </div>
                <form id="form1" action="#" method="GET">
                    <div class="row">                    
                        <div class="col-6">
                            <div class="card">
                                <div class="card-header">
                                    
                                    <h3 id="city_h2" class="card-title">Ciudad</h3>
                                    <div class= "form-group mb-2">
                                        <label class="font-weigth-bold" for="indicador">El tiempo en la ciudad buscada es:</label>
                                                                
                                    </div>    
                                </div>
                                <div class="card-body mb-1">
                                    <table class="table table-hover">
                                        <tr>
                                            <td><p class="card-text">Código País: </p></td>
                                            <td class="table-light" width="290px" id="country"></td>
                                        </tr>
                                        <tr>
                                            <td><p class="card-text">Longitud: </p></td>
                                            <td class="table-light" id="lon"></td>
                                        </tr>
                                        <tr>
                                            <td><p class="card-text">Latitud: </p></td>
                                            <td class="table-light" id="lat"></td>
                                        </tr>
                                        <tr>
                                            <td><p class="card-text">Cielo: </p></td>
                                            <td class="table-light" id="desc"></td>
                                        </tr>
                                        <tr>
                                            <td><p class="card-text">Temperatura actual (°C): </p></td>
                                            <td class="table-light" id="temp"></td>
                                        </tr>
                                        <tr>
                                            <td><p class="card-text">Temperatura min (°C): </p></td>
                                            <td class="table-light" id="temp_min"></td>
                                        </tr>
                                        <tr>
                                            <td><p class="card-text">Temperatura max (°C): </p></td>
                                            <td class="table-light" id="temp_max"></td>
                                        </tr>
                                        <tr>
                                            <td><p class="card-text">Presión (hPa): </p></td>
                                            <td class="table-light" id="pressure"></td>
                                        </tr>
                                        <tr>
                                            <td><p class="card-text">Humedad (%): </p></td>
                                            <td class="table-light" id="humidity"></td>
                                        </tr>
                                        <tr>
                                            <td><p class="card-text">Velocidad de viento (m/s): </p></td>
                                            <td class="table-light" id="speed"></td>
                                        </tr>
                                        <tr>
                                            <td><p class="card-text">Dirección del viento (grados): </p></td>
                                            <td class="table-light" id="deg"></td>
                                        </tr>                                     
                                    </table>                                    
                                </div>                             
                            </div>
                        </div>
                        <div class="col-3">
                            <label class="font-weigth-bold mt-0 ms-3" for="city">Escriba una ciudad</label>
                            <input id="txt_city" class="form-control mt-2 mb-2 ms-3" type="text" name="city">
                            
                            <label class="font-weigth-bold mt-2 ms-3" for="Apikey">ingrese su Api-Key</label>
                            <input class="form-control mt-2 mb-2 ms-3" type="password" name="apikey" id="apikey">
                        <div class="row d-flex justify-content-around">
                            <div class="col-5 d-grid gap-2">
                                <button id="btn_buscar" type="button" class="btn btn-outline-secondary btn-md mt-4 ms-3">Buscar</button>
                            </div>
                            <div class="col-5 d-grid gap-2">
                                <button class="btn btn-outline-secondary btn-md mt-4 ms-3" id="reset" type="reset">Reset</button>
                            </div>                            
                        </div>                  
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <pre>  https://openweathermap.org</pre>
                        </div>
                    </div> 
                </form>
            </div>
        </div>
    </div>
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
</body>
</html>